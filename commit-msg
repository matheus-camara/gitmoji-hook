#!/usr/bin/env node

const fs = require('fs');
const TIMEOUT_THRESHOLD = 3000;

checkCommitMessage();
hookCleanup();

async function checkCommitMessage() {

    const message = fs.readFileSync(process.argv[2], 'utf8').trim();
    fs.writeFileSync(process.argv[2], emojify(message));
    process.exit(0);
}

function emojify(message) {
    let words = message.split(' ');
    let emojiCode = words[0];
    let emojilessMessage = words.slice(1).join(' ');
    let emoji = getEmoji(emojiCode);

    return `${emoji} ${emojilessMessage}`;
}

function getEmoji(code) {
    switch (code) {
        case ':sparkles:':
            return '‚ú®';
        case ':art:':
            return 'üé®';
        case ':zap:':
            return '‚ö°Ô∏è';
        case ':fire:':
            return 'üî•';
        case ':bug:':
            return 'üêõ';
        case ':ambulance:':
            return 'üöë';
        case ':rocket:':
            return 'üöÄ';
        case ':lipstick:':
            return 'üíÑ';
        case ':tada:':
            return 'üéâ';
        case ':white_check_mark:':
            return '‚úÖ';
        case ':lock:':
            return 'üîí';
        case ':bookmark:':
            return 'üîñ';
        case ':rotating_light:':
            return 'üö®';
        case ':construction:':
            return 'üöß';
        case ':green_heart:':
            return 'üíö';
        case ':arrow_down:':
            return '‚¨áÔ∏è';
        case ':arrow_up:':
            return '‚¨ÜÔ∏è';
        case ':pushpin:':
            return 'üìå';
        case ':construction_worker:':
            return 'üë∑';
        case ':chart_with_upwards_trend:':
            return 'üìà';
        case ':recycle:':
            return '‚ôªÔ∏è';
        case ':heavy_plus_sign:':
            return '‚ûï';
        case ':heavy_minus_sign:':
            return '‚ûñ';
        case ':wrench:':
            return 'üîß';
        case ':hammer:':
            return 'üî®';
        case ':globe_with_meridians:':
            return 'üåê';
        case ':pencil2:':
            return '‚úèÔ∏è';
        case ':poop:':
            return 'üí©';
        case ':rewind:':
            return '‚è™';
        case ':twisted_rightwards_arrows:':
            return 'üîÄ';
        case ':package:':
            return 'üì¶';
        case ':alien:':
            return 'üëΩ';
        case ':truck:':
            return 'üöö';
        case ':page_facing_up:':
            return 'üìÑ';
        case ':boom:':
            return 'üí•';
        case ':bento:':
            return 'üç±';
        case ':wheelchair:':
            return '‚ôøÔ∏è';
        case ':bulb:':
            return 'üí°';
        case ':beers:':
            return 'üçª';
        case ':speech_balloon:':
            return 'üí¨';
        case ':card_file_box:':
            return 'üóÉ';
        case ':loud_sound:':
            return 'üîä';
        case ':mute:':
            return 'üîá';
        case ':busts_in_silhouette:':
            return 'üë•';
        case ':children_crossing:':
            return 'üö∏';
        case ':building_construction:':
            return 'üèó';
        case ':iphone:':
            return 'üì±';
        case ':clown_face:':
            return 'ü§°';
        case ':egg:':
            return 'ü•ö';
        case ':see_no_evil:':
            return 'üôà';
        case ':camera_flash:':
            return 'üì∏';
        case ':alembic:':
            return '‚öó';
        case ':mag:':
            return 'üîç';
        case ':label:':
            return 'üè∑Ô∏è';
        case ':seedling:':
            return 'üå±';
        case ':triangular_flag_on_post:':
            return 'üö©';
        case ':goal_net:':
            return 'üóë';
        case ':hammer:':
            return 'üí´';
        case ':wastebasket:':
            return 'üóë';
        case ':passport_control:':
            return 'üõÇ';
        case ':adhesive_bandage:':
            return 'ü©π';
        default:
            return code;
    }
}

function hookCleanup() {

    setTimeout(() => {
        console.log(' Algo de errado n√£o est√° certo com o hook, sorry');
        console.log(' O Commit ser√° rejeitado por quest√£o de seguran√ßa');
        console.log(' Mais informa√ß√µes podem ser encontradas aqui: https://git-scm.com/book/uz/v2/Customizing-Git-An-Example-Git-Enforced-Policy');
        process.exit(1);
    }, TIMEOUT_THRESHOLD);

}